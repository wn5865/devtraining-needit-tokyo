<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_ux_client_script">
    <sys_ux_client_script action="INSERT_OR_UPDATE">
        <includes>45cf8914eb320110f7e105a3a25228ab</includes>
        <macroponent display_value="DA Modal Ref Tree Pick Lookup">06d97eeb97c92110c18076021153afc5</macroponent>
        <name>Expand item on Load</name>
        <preset/>
        <required_translations/>
        <script><![CDATA[/**
 * @param {params} params
 * @param {api} params.api
 * @param {any} params.event
 * @param {any} params.imports
 * @param {ApiHelpers} params.helpers
 */
function handler({ api, event, helpers, imports }) {
	const { parseGroupTree, parseGeneralTree, addNewChild, generateRequestURL } =
		imports['global.Content Tree Utils']();
	const {
		props: { table, referenceTable, referenceField, dependentField, query }
	} = api.context;
	let nameSuffix = 'parent';
	let type = 'child';
	const name = `${referenceTable}.${nameSuffix}`;
	const {
		treePickerConfig: { processor, targetPath = '', targetValue },
		domainID
	} = api.data.tree_picker.treePicker;
	const reference = `${table}.${referenceField}`;
	const target =
		dependentField === ''
			? `${referenceTable}.undefined`
			: `${referenceTable}.${dependentField}`;

	const generateTargetPath = (index, targetPath) => {
		const path = [];
		for (let i = 0; i <= index; i++) path.push(targetPath[i]);
		return path;
	};

	function finalResponse({ api, response, targetPath, currentIndex }) {
		const xml = Object.values(response).join('');
		const treeJSON =
			referenceTable === 'sys_user_group'
				? parseGroupTree(xml)
				: parseGeneralTree(xml);
		const newTreeJSON = addNewChild(
			api.state.treeItems[0],
			generateTargetPath(currentIndex, targetPath),
			treeJSON
		);
		api.setState('loadingItems', []);
		api.setState('treeItems', [newTreeJSON]);
		api.setState('selectedItems', [targetPath]);
	}

	function getHttpPromise({
		api,
		helpers,
		targetPath,
		currentIndex,
		response
	}) {
		if (response) {
			const xml = Object.values(response).join('');
			const treeJSON =
				referenceTable === 'sys_user_group'
					? parseGroupTree(xml)
					: parseGeneralTree(xml);
			const newTreeJSON = addNewChild(
				api.state.treeItems[0],
				generateTargetPath(currentIndex - 1, targetPath),
				treeJSON
			);
			api.setState('treeItems', [newTreeJSON]);
		}
		api.setState('expandedItems', ({ api }) => [
			...api.state.expandedItems,
			generateTargetPath(currentIndex, targetPath)
		]);
		api.setState('loadingItems', [
			{
				path: generateTargetPath(currentIndex, targetPath),
				error: false
			}
		]);
		helpers
			.snHttp(
				generateRequestURL(
					processor,
					name,
					type,
					targetPath[currentIndex],
					reference,
					target,
					targetValue,
					domainID,
					query
				),
				{
					method: 'POST',
					batch: false,
					body: {},
					headers: {
						'X-WantSessionNotificationMessages': 'true',
						'Content-Type': 'application/x-www-form-urlencoded; charset=utf-8'
					}
				}
			)
			.then(({ response }) => {
				const newIndex = currentIndex + 1;
				if (newIndex === targetPath.length)
					finalResponse({
						api,
						response,
						targetPath,
						currentIndex
					});
				else
					getHttpPromise({
						api,
						helpers,
						targetPath,
						currentIndex: newIndex,
						response
					});
			});
	}

	let value = [[]];
	if (targetPath) {
		value = targetPath.split(';').reduce((target, source) => {
			target.push(source.split(','));
			return target;
		}, []);
	}
	getHttpPromise({
		api,
		helpers,
		targetPath: value[0],
		currentIndex: 0
	});
}
]]></script>
        <script_api_version>2.0.0</script_api_version>
        <sys_class_name>sys_ux_client_script</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2023-02-22 15:38:54</sys_created_on>
        <sys_id>eed9beeb97c92110c18076021153af52</sys_id>
        <sys_name>Expand item on Load</sys_name>
        <sys_package display_value="NeedIt" source="x_58872_needit">6ead8e780f603200cd674f8ce1050ed1</sys_package>
        <sys_policy/>
        <sys_scope display_value="NeedIt">6ead8e780f603200cd674f8ce1050ed1</sys_scope>
        <sys_update_name>sys_ux_client_script_eed9beeb97c92110c18076021153af52</sys_update_name>
        <target>macroponent</target>
        <type>default</type>
    </sys_ux_client_script>
</record_update>
